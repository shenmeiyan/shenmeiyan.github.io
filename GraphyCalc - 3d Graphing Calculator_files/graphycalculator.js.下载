var GraphyCalculator=function(){function l(a,c,b,i){return{lbp:c,led:function(h,j){this.left=h;this.right=j.expression(c-b,j);this.type="op_b"+a;return this},nud:function(h){if(i!==1)throw"error in operator nud";this.left=h.expression(70,h);this.type="op_u"+a;return this}}}function m(a){return{type:"value",value:a,led:function(){throw"led called on a value token.";},nud:function(){return this}}}function n(a,c){return{type:"function",value:a,func_name:c,led:function(){throw"Internal error: led called on a function.";
},nud:function(b){this.left=b.expression(70,b);return this}}}function o(a){return{type:"variable",value:a,led:function(){throw"Internal error: led called on a variable.";},nud:function(){return this}}}function p(a){for(var c=[],b=0,i=a.length,h=/^-?[0-9]+/,j=/^-?(([0-9]+\.[0-9]*)|(\.[0-9]+))/,q=/^[a-zA-Z_][a-zA-Z0-9_]*/;b<i;){var e=a.slice(b),d;switch(e[0]){case "+":case "-":c.push(l(e[0],50,0,1));++b;continue;case "*":case "/":c.push(l(e[0],60,0,0));++b;continue;case "^":c.push(l(e[0],75,1,0));++b;
continue;case ")":c.push({type:")",lbp:0,led:function(){throw"Internal error: led called on ')'";},nud:function(){throw"Internal error: nud called on ')'";}});++b;continue;case "(":c.push({type:"(",lbp:80,led:function(){throw"Interal error, led called on '('";},nud:function(k){var r=k.expression(0,k);if(k.token().type!=")")throw"Unmatched left parenthesis.";k.advance();return r}});++b;continue;case " ":case "\t":case "\r":case "\n":++b;continue;default:}if((d=e.match(j))!==null){c.push(m(parseFloat(d[0])));
b+=d[0].length}else if((d=e.match(h))!==null){c.push(m(parseInt(d[0])));b+=d[0].length}else if((d=e.match(q))!==null){if(d[0]=="x"||d[0]=="y")c.push(o(d[0]));else{e=s[d[0]];if(e!==undefined)c.push(n(e,d[0]));else{e=t[d[0]];if(e!==undefined)c.push(m(e));else throw"unknown symbol "+d[0];}}b+=d[0].length}else throw"Failed in processing input: "+e;}return c}function u(a){a={tokens:a,i:0,at_end:function(){return this.i>=this.tokens.length},token:function(){if(this.at_end())return{lbp:0,type:"end"};return this.tokens[this.i]},
advance:function(){++this.i},expression:function(c,b){if(!b.at_end()){var i=b.token();b.advance();for(var h=i.nud(b);c<b.token().lbp;){i=b.token();b.advance();h=i.led(h,b)}return h}}};return a.expression(0,a)}function f(a,c,b){if(a===undefined)throw"Error parsing input, probably invalid.";switch(a.type){case "value":return a.value;case "variable":return a.value==="x"?c:b;case "function":return a.value(f(a.left,c,b));case "op_u+":return f(a.left,c,b);case "op_b+":return f(a.left,c,b)+f(a.right,c,b);
case "op_u-":return-f(a.left,c,b);case "op_b-":return f(a.left,c,b)-f(a.right,c,b);case "op_b*":return f(a.left,c,b)*f(a.right,c,b);case "op_b/":return f(a.left,c,b)/f(a.right,c,b);case "op_b^":return Math.pow(f(a.left,c,b),f(a.right,c,b));default:throw"Internal error, unhandled node: "+a.type+" "+a.value;}}function g(a){if(a===undefined)throw"Error parsing input, probably invalid.";switch(a.type){case "value":return a.value.toExponential();case "variable":return a.value;case "function":return a.func_name+
"("+g(a.left)+")";case "op_u+":return"(+"+g(a.left)+")";case "op_b+":return"("+g(a.left)+"+"+g(a.right)+")";case "op_u-":return"(-"+g(a.left)+")";case "op_b-":return"("+g(a.left)+"-"+g(a.right)+")";case "op_b*":return"("+g(a.left)+"*"+g(a.right)+")";case "op_b/":return"("+g(a.left)+"/"+g(a.right)+")";case "op_b^":return"pow("+g(a.left)+","+g(a.right)+")";default:throw"Internal error, unhandled node: "+a.type+" "+a.value;}}var s={abs:Math.abs,acos:Math.acos,asin:Math.asin,atan:Math.atan,ceil:Math.ceil,
cos:Math.cos,exp:Math.exp,floor:Math.floor,log:Math.log,round:Math.round,sin:Math.sin,sinc:function(a){return a==0?1:Math.sin(a)/a},sqrt:Math.sqrt,tan:Math.tan},t={E:Math.E,e:Math.E,pi:Math.PI,PI:Math.PI};return{parse:function(a){return u(p(a))},create_evaluator:function(a){return function(c,b){return f(a,c,b)}},generate_expression_string:function(a){return g(a)}}}();
